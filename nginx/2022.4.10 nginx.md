## 2022.4.10 nginx

1. nginx 启动时会启动 master 进程（主进程）、worker 进程（子进程），master 进程主要是协调  worker 进程工作，当一个请求到 nginx 中时会由 master 进程把该请求分给 worker 进程，然后 worker 进程根据请求在配置文件中找到相应的资源位置，随后将用户需要的内容转发出去；
2. 反向代理解释，网络中代理我们都可以理解，就是当我们需要访问某个资源时，不直接访问资源所在 ip，而是把需要的资源请求发送到代理，然后由代理替我们获取资源（这也是正向代理）；那么反向代理呢，就是这个代理不是帮我们去获取资源的，而是帮我们把资源给其他请求的；
3. nginx 作为代理服务器，也可以称为隧道式代理，也就是所有的请求和响应都得通过这个隧道来进行，好处是可以进行控制请求，过滤请求，同时可以决定将请求转发给什么服务端；坏处时当并发过高时，由于所有请求和响应都得通过 nginx，导致 nginx 代理服务器的性能瓶颈成为了整个系统的性能瓶颈；（解决方法：使用 DR 模型，请求走 nginx，响应直接绕过 nginx 直接返回给请求 nginx 的服务器；—— LVS 模型，就是 nginx 常用的模型，请求和响应都走 nginx）；
4. nginx 本身的负载均衡测试中仅有 weight 常用，其他的比如：down、backup 用的比较少，主要是每次都需要更改配置文件，然后重启 nginx；
5. 当我们使用 nginx 作为负载均衡时（应用层采用集群方式部署），这是将会产生客户状态无法保存的情况，简而言之就是你上次访问的是另一个服务器，下次访问时被负载到了其他服务器中，当时上次访问时的用户数据仍然保留在上台服务器中；该问题的解决方案主要有

```
（1）使用 redis 作为 session 服务器　——把所有 session 存放在指定的 redis 服务器中，但是面对高并发的场景，该方法仍然会大大限制性能；
（2）使用 token，将客户数据进行加密构成 token，当用户发送请求时会携带 token，然后由服务器对 token 进行解密获取客户数据，相当于将客户数据作为 cookie 值在客户端与服务端来回传送；
```

